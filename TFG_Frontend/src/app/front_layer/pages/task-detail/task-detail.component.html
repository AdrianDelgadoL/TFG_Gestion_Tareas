
<div class="container">
  <mat-sidenav-container class="sidenav-container" autosize >
    <mat-sidenav #sidenav mode="over" (closed)="sidenavDirty = true">
      <mat-selection-list [(ngModel)]="assignedWorkers" class="sidenav"> <!-- Data binding is used since the drawer is outside the form -->
        <mat-list-option *ngFor="let worker of workers" [value]="worker.id">{{worker.name}} {{worker.surname}}</mat-list-option>
      </mat-selection-list>
    </mat-sidenav>

    <mat-sidenav-content class="sidenav-content" [formGroup]="form">

      <div class="button">
        <button *ngIf="!disabled" mat-raised-button type="button" (click)="updateTask()">Terminar</button>
        <button *ngIf="disabled" mat-raised-button type="button" (click)="disabled = !disabled">Modificar</button>
      </div>

      <p>
        <mat-form-field appearance="fill">
          <mat-label>Nombre de tarea</mat-label>
          <input [readonly]="disabled" matInput formControlName="name" required>
          <mat-error *ngIf="form.controls['name'].errors">Introduce un nombre de tarea</mat-error>
        </mat-form-field>

        <span class="spacer"></span>
        <mat-form-field>
          <mat-label>Empleados asignados</mat-label>
          <input readonly [value]="assignedWorkers" matInput>
          <button [disabled]="disabled" mat-icon-button matSuffix (click)="sidenav.toggle()"><mat-icon>+</mat-icon></button>
          <mat-error *ngIf="sidenavDirty && assignedWorkers.length <= 0">Selecciona trabajadores para la tarea</mat-error>
        </mat-form-field>
      </p>

      <p>
        <mat-form-field appearance="fill">
          <mat-label>Tipo de tarea</mat-label>
          <mat-select [disabled]="disabled" formControlName="type">
            <mat-option *ngFor="let spec of specs" [value]="spec.id">
              {{spec.name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="form.controls['type'].errors">Elige un tipo de tarea</mat-error>
        </mat-form-field>

        <span class="spacer"></span>

        <mat-form-field appearance="fill">
          <mat-label>Elige una fecha</mat-label>
          <input [readonly]="disabled" matInput formControlName="date" [matDatepicker]="picker" required>
          <mat-datepicker-toggle [disabled]="disabled" matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="form.controls['date'].errors">Elige una fecha</mat-error>
        </mat-form-field>
      </p>

      <p class="description">
        <mat-form-field style="width: 100%" appearance="outline" >
          <mat-label>Descripción</mat-label>
          <textarea [readonly]="disabled" matInput formControlName="description"></textarea>
        </mat-form-field>
      </p>

      <p *ngIf="error" class="mat-error">
        {{error}}
      </p>
      <button *ngIf="!disabled" mat-raised-button style="max-width: 20%; align-self: center" type="button">Añadir campo</button>

    </mat-sidenav-content>

  </mat-sidenav-container>


</div>
